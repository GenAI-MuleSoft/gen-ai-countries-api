<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:apikit="http://www.mulesoft.org/schema/mule/mule-apikit" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd http://www.mulesoft.org/schema/mule/mule-apikit http://www.mulesoft.org/schema/mule/mule-apikit/current/mule-apikit.xsd http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd ">
    <http:listener-config name="gen-ai-countries-api-httpListenerConfig">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <apikit:config name="gen-ai-countries-api-config" api="gen-ai-countries-api.raml" outboundHeadersMapName="outboundHeaders" httpStatusVarName="httpStatus" />
    <flow name="gen-ai-countries-api-main">
        <http:listener config-ref="gen-ai-countries-api-httpListenerConfig" path="/api/*">
            <http:response statusCode="#[vars.httpStatus default 200]">
                <http:headers>#[vars.outboundHeaders default {}]</http:headers>
            </http:response>
            <http:error-response statusCode="#[vars.httpStatus default 500]">
                <http:body>#[payload]</http:body>
                <http:headers>#[vars.outboundHeaders default {}]</http:headers>
            </http:error-response>
        </http:listener>
        <apikit:router config-ref="gen-ai-countries-api-config" />
        <error-handler>
            <on-error-propagate type="APIKIT:BAD_REQUEST">
                <ee:transform doc:name="Transform Message">
                    <ee:message>
                        <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{message: "Bad request"}]]></ee:set-payload>
                    </ee:message>
                    <ee:variables>
                        <ee:set-variable variableName="httpStatus">400</ee:set-variable>
                    </ee:variables>
                </ee:transform>
            </on-error-propagate>
            <on-error-propagate type="APIKIT:NOT_FOUND">
                <ee:transform doc:name="Transform Message">
                    <ee:message>
                        <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{message: "Resource not found"}]]></ee:set-payload>
                    </ee:message>
                    <ee:variables>
                        <ee:set-variable variableName="httpStatus">404</ee:set-variable>
                    </ee:variables>
                </ee:transform>
            </on-error-propagate>
            <on-error-propagate type="APIKIT:METHOD_NOT_ALLOWED">
                <ee:transform doc:name="Transform Message">
                    <ee:message>
                        <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{message: "Method not allowed"}]]></ee:set-payload>
                    </ee:message>
                    <ee:variables>
                        <ee:set-variable variableName="httpStatus">405</ee:set-variable>
                    </ee:variables>
                </ee:transform>
            </on-error-propagate>
            <on-error-propagate type="APIKIT:NOT_ACCEPTABLE">
                <ee:transform doc:name="Transform Message">
                    <ee:message>
                        <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{message: "Not acceptable"}]]></ee:set-payload>
                    </ee:message>
                    <ee:variables>
                        <ee:set-variable variableName="httpStatus">406</ee:set-variable>
                    </ee:variables>
                </ee:transform>
            </on-error-propagate>
            <on-error-propagate type="APIKIT:UNSUPPORTED_MEDIA_TYPE">
                <ee:transform doc:name="Transform Message">
                    <ee:message>
                        <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{message: "Unsupported media type"}]]></ee:set-payload>
                    </ee:message>
                    <ee:variables>
                        <ee:set-variable variableName="httpStatus">415</ee:set-variable>
                    </ee:variables>
                </ee:transform>
            </on-error-propagate>
            <on-error-propagate type="APIKIT:NOT_IMPLEMENTED">
                <ee:transform doc:name="Transform Message">
                    <ee:message>
                        <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{message: "Not Implemented"}]]></ee:set-payload>
                    </ee:message>
                    <ee:variables>
                        <ee:set-variable variableName="httpStatus">501</ee:set-variable>
                    </ee:variables>
                </ee:transform>
            </on-error-propagate>
        </error-handler>
    </flow>
    <flow name="gen-ai-countries-api-console">
        <http:listener config-ref="gen-ai-countries-api-httpListenerConfig" path="/console/*">
            <http:response statusCode="#[vars.httpStatus default 200]">
                <http:headers>#[vars.outboundHeaders default {}]</http:headers>
            </http:response>
            <http:error-response statusCode="#[vars.httpStatus default 500]">
                <http:body>#[payload]</http:body>
                <http:headers>#[vars.outboundHeaders default {}]</http:headers>
            </http:error-response>
        </http:listener>
        <apikit:console config-ref="gen-ai-countries-api-config" />
        <error-handler>
            <on-error-propagate type="APIKIT:NOT_FOUND">
                <ee:transform doc:name="Transform Message">
                    <ee:message>
                        <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{message: "Resource not found"}]]></ee:set-payload>
                    </ee:message>
                    <ee:variables>
                        <ee:set-variable variableName="httpStatus">404</ee:set-variable>
                    </ee:variables>
                </ee:transform>
            </on-error-propagate>
        </error-handler>
    </flow>
    <flow name="get:\countries:gen-ai-countries-api-config">
        <ee:transform doc:name="Transform Message">
            <ee:message>
                <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
[
  {
    name: {
      common: "Mauritania",
      official: "Islamic Republic of Mauritania",
      nativeName: {
        ara: {
          official: "الجمهورية الإسلامية الموريتانية",
          common: "موريتانيا"
        }
      }
    },
    tld: [
      ".mr"
    ],
    cca2: "MR",
    ccn3: "478",
    cca3: "MRT",
    cioc: "MTN",
    independent: true,
    status: "officially-assigned",
    unMember: true,
    currencies: {
      MRU: {
        name: "Mauritanian ouguiya",
        symbol: "UM"
      }
    },
    idd: {
      root: "+2",
      suffixes: [
        "22"
      ]
    },
    capital: [
      "Nouakchott"
    ],
    altSpellings: [
      "MR", 
      "Islamic Republic of Mauritania", 
      "al-Jumhūriyyah al-ʾIslāmiyyah al-Mūrītāniyyah"
    ],
    region: "Africa",
    subregion: "Western Africa",
    languages: {
      ara: "Arabic"
    },
    translations: {
      ara: {
        official: "الجمهورية الإسلامية الموريتانية",
        common: "موريتانيا"
      },
      bre: {
        official: "Republik islamek Maouritania",
        common: "Maouritania"
      },
      ces: {
        official: "Mauritánská islámská republika",
        common: "Mauritánie"
      },
      cym: {
        official: "Islamic Republic of Mauritania",
        common: "Mauritania"
      },
      deu: {
        official: "Islamische Republik Mauretanien",
        common: "Mauretanien"
      },
      est: {
        official: "Mauritaania Islamivabariik",
        common: "Mauritaania"
      },
      fin: {
        official: "Mauritanian islamilainen tasavalta",
        common: "Mauritania"
      },
      fra: {
        official: "République islamique de Mauritanie",
        common: "Mauritanie"
      },
      hrv: {
        official: "Islamska Republika Mauritanija",
        common: "Mauritanija"
      },
      hun: {
        official: "Mauritániai Iszlám Köztársaság",
        common: "Mauritánia"
      },
      ita: {
        official: "Repubblica islamica di Mauritania",
        common: "Mauritania"
      },
      jpn: {
        official: "モーリタニア·イスラム共和国",
        common: "モーリタニア"
      },
      kor: {
        official: "모리타니 이슬람 공화국",
        common: "모리타니"
      },
      nld: {
        official: "Islamitische Republiek Mauritanië",
        common: "Mauritanië"
      },
      per: {
        official: "جمهوری اسلامی موریتانی",
        common: "موریتانی"
      },
      pol: {
        official: "Islamska Republika Mauretańska",
        common: "Mauretania"
      },
      por: {
        official: "República Islâmica da Mauritânia",
        common: "Mauritânia"
      },
      rus: {
        official: "Исламская Республика Мавритания",
        common: "Мавритания"
      },
      slk: {
        official: "Mauritánska islamská republika",
        common: "Mauritánia"
      },
      spa: {
        official: "República Islámica de Mauritania",
        common: "Mauritania"
      },
      srp: {
        official: "Исламска Република Мауританија",
        common: "Мауританија"
      },
      swe: {
        official: "Islamiska republiken Mauretanien",
        common: "Mauretanien"
      },
      tur: {
        official: "Moritanya İslam Cumhuriyeti",
        common: "Moritanya"
      },
      urd: {
        official: "اسلامی جمہوریہ موریتانیہ",
        common: "موریتانیہ"
      },
      zho: {
        official: "毛里塔尼亚伊斯兰共和国",
        common: "毛里塔尼亚"
      }
    },
    latlng: [
      20.0, 
      -12.0
    ],
    landlocked: false,
    borders: [
      "DZA", 
      "MLI", 
      "SEN", 
      "ESH"
    ],
    area: 1030700.0,
    demonyms: {
      eng: {
        f: "Mauritanian",
        m: "Mauritanian"
      },
      fra: {
        f: "Mauritanienne",
        m: "Mauritanien"
      }
    },
    flag: "🇲🇷",
    maps: {
      googleMaps: "https://goo.gl/maps/im2MmQ5jFjzxWBks5",
      openStreetMaps: "https://www.openstreetmap.org/relation/192763"
    },
    population: 4649660,
    gini: {
      "2014": 32.6
    },
    fifa: "MTN",
    car: {
      signs: [
        "RIM"
      ],
      side: "right"
    },
    timezones: [
      "UTC"
    ],
    continents: [
      "Africa"
    ],
    flags: {
      png: "https://flagcdn.com/w320/mr.png",
      svg: "https://flagcdn.com/mr.svg",
      alt: "The flag of Mauritania has a green field with a thin red horizontal band at the top and bottom of the field. At the center of the field is a five-pointed yellow star above an upward facing yellow crescent."
    },
    coatOfArms: {
      png: "https://mainfacts.com/media/images/coats_of_arms/mr.png",
      svg: "https://mainfacts.com/media/images/coats_of_arms/mr.svg"
    },
    startOfWeek: "monday",
    capitalInfo: {
      latlng: [
        18.07, 
        -15.97
      ]
    }
  }
]]]></ee:set-payload>
            </ee:message>
        </ee:transform>
    </flow>
</mule>
